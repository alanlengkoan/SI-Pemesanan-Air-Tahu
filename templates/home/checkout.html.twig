{% extends 'layout.html.twig' %}

{% block title %}Checkout{% endblock %}

{% block body %}
{# begin:: background #}
<section class="hero-wrap hero-wrap-2" style="background-image: url('../assets/user/images/tahu.jpg');" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
    <div class="container">
        <div class="row no-gutters slider-text align-items-end justify-content-center">
            <div class="col-md-9 ftco-animate mb-5 text-center">
                <h2 class="mb-0 bread">Keranjang</h2>
            </div>
        </div>
    </div>
</section>
{# end:: background #}

<section class="ftco-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-12 ftco-animate">

                <form class="billing-form" action="/user/finish" method="post">
                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('submit') }}">
                    {# begin:: form #}
                    <h3 class="mb-4 billing-heading">Detail Pembayaran</h3>
                    <div class="row align-items-end">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="inpkodeorder">Kode Order</label>
                                <input type="text" class="form-control" name="inpkodeorder" id="inpkodeorder"
                                    value="{{ kd_order }}" readonly="readonly" />
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="inpnama">Nama *</label>
                                <input type="text" class="form-control" name="inpnama" id="inpnama"
                                    value="{{ user.nama }}" required="required" />
                                <div id="error"></div>
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="inpemail">Email *</label>
                                <input type="text" class="form-control" name="inpemail" id="inpemail"
                                    value="{{ user.email }}" required="required" />
                                <div id="error"></div>
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="inpnotelpon">No. Telepon *</label>
                                <input type="text" class="form-control" name="inpnotelpon" id="inpnotelpon"
                                    value="{{ user.telepon }}" required="required" />
                                <div id="error"></div>
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="inpkelamin">Jenis Kelamin *</label>
                                <div class="select-wrap">
                                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                                    <select class="form-control" name="inpkelamin" id="inpkelamin" required="required">
                                        <option value="">- Pilih -</option>
                                        <option {{ (user.kelamin == 'L') ? 'selected' : '' }} value="L">Laki - laki
                                        </option>
                                        <option {{ (user.kelamin == 'P') ? 'selected' : '' }} value="P">Perempuan
                                        </option>
                                    </select>
                                    <div id="error"></div>
                                </div>
                            </div>
                        </div>
                        <div class="w-100"></div>
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="inpalamat">Alamat *</label>
                                <textarea class="form-control" name="inpalamat" id="inpalamat"
                                    required="required">{{ user.alamat }}</textarea>
                                <div id="error"></div>
                            </div>
                        </div>
                    </div>
                    {# end:: form #}

                    {# begin:: table #}
                    <div class="table-wrap">
                        <table class="table">
                            <thead class="thead-primary">
                                <tr>
                                    <th>Gambar</th>
                                    <th>Nama</th>
                                    <th>Jumlah</th>
                                    <th>Harga</th>
                                    <th>Sub Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% set sum = 0 %}
                                {% for rows in checkout %}
                                {% set sum = sum + rows.sub_total  %}
                                <tr>
                                    <td><img src="{{ asset('uploads/produk/'~rows.gambar) }}" width="100" heigth="100" />
                                    </td>
                                    <td>
                                        {{ rows.nama }}
                                    </td>
                                    <td>
                                        {{ rows.jumlah }}
                                    </td>
                                    <td>
                                        {{ rows.harga|format_rp }}
                                    </td>
                                    <td>
                                        <span id="sub-total">{{ rows.sub_total|format_rp }}</span>
                                    </td>
                                </tr>
                                {% endfor %}
                                <tr>
                                    <td colspan="4" align="center">
                                        Total
                                    </td>
                                    <td align="center">
                                        <span id="total">{{ sum|format_rp }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="4" align="center">
                                        Grand Total
                                    </td>
                                    <td align="center">
                                        <span id="total">{{ sum|format_rp }}</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    {# end:: table #}

                    {# begin:: form pembayaran #}
                    <h3 class="mb-4 billing-heading">Pembayaran</h3>
                    <div class="row align-items-end">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="inpmetodepembayaran">Metode Pembayaran *</label>
                                <div class="select-wrap">
                                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                                    <select class="form-control" name="inpmetodepembayaran" id="inpmetodepembayaran" required="required">
                                         <option value="">- Pilih -</option>
                                        <option value="c">COD</option>
                                        <option value="t">Transfer</option>
                                    </select>
                                </div>
                            </div>
                        </div>                        
                        <div id="transfer" style="display: none;">
                            <div class="w-100"></div>
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label for="inpidbank">Bank *</label>
                                    <div class="select-wrap">
                                        <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                                        <select class="form-control" name="inpidbank" id="inpidbank">
                                            <option value="">- Pilih -</option>
                                            {% for rows in bank %}
                                                <option value="{{ rows.id_bank }}" data-rekening="{{ rows.rekening }}">{{ rows.nama }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div id="nomor_rekening" style="display: none">
                                <div class="w-100"></div>
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="inpkodeorder">Nomor Rekening</label>
                                        <input class="form-control" type="text" id="inprekening" value="0" readonly="readonly" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {# end:: form pembayaran #}

                    <button type="submit" class="btn btn-primary py-3 px-4">
                        Proses
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block javascripts %}
<script>
    // untuk pilih metode pembayaran
    var untukMetodePembayaran = function () {
        $(document).on('change', '#inpmetodepembayaran', function () {
            var ini = $(this);
            var val = ini.val();

            if (val == 't') {
                $('#transfer').attr('style', 'width: 100%');
                $('#inpidbank').attr('required', 'required');
            } else {
                $('#transfer').attr('style', 'display: none');
                $('#inpidbank').removeAttr('required');
                $('#inpidbank').val('');
            }
        });
    }();

    // untuk tampilkan nomor rekening
    var untukNoRekening = function(){
        $(document).on('change', '#inpidbank', function () {
            var ini = $(this);
            var no_rekening = ini.find(':selected').data('rekening');

            if (ini.val() != '') {
                $('#nomor_rekening').attr('style', 'width: 100%');
                $('#inprekening').val(no_rekening);
            } else {
                $('#nomor_rekening').attr('style', 'display: none');
            }
        });
    }();

    // untuk angka
    function justAngka(e) {
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190, 77]) !== -1 ||
            (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
            (e.keyCode >= 35 && e.keyCode <= 40)) {
            return;
        }
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
    };

    // untuk format harga
    function autoSeparator(Num) {
        Num += '';
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        x = Num.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1))
            x1 = x1.replace(rgx, '$1' + '.' + '$2');
        return x1 + x2;
    };
</script>
{% endblock %}