{% extends 'admin/layout_admin.html.twig' %}

{% block title %}Laporan{% endblock %}

{% block stylesheets %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/css/bootstrap-datepicker3.css" rel="stylesheet"/>
{% endblock %}

{% block body %}
{# begin:: head #}
<div class="page-breadcrumb">
    <div class="row">
        <div class="col-7 align-self-center">
            <h2 class="page-title text-truncate text-dark font-weight-medium mb-1">{{ halaman }}</h2>
        </div>
    </div>
</div>
{# end:: head #}

{# begin:: body #}
<div class="container-fluid">
    {# begin:: form #}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Form</h3>
                    <hr>
                    <form id="form-add" action="laporan/lihat" method="post" enctype="multipart/form-data">
                        <input type="hidden" name="_csrf_token" value="{{ csrf_token('submit') }}">

                        <div class="form-group">
                            <h4 class="card-title">Dari tanggal *</h4>
                            <input type="text" class="form-control form-control-sm datepicker" name="tanggal_awal" id="tanggal_awal" readonly="readonly" placeholder="YYYY-MM-DD" />
                            <br>
                            <h4 class="card-title">Sampai tanggal *</h4>
                            <input type="text" class="form-control form-control-sm datepicker" name="tanggal_akhir" id="tanggal_akhir" readonly="readonly" placeholder="YYYY-MM-DD" />
                            <br>
                        </div>
                        <button type="submit" id="add" class="btn btn-outline-primary btn-sm btn-rounded">
                            <i class="fas fa-eye"></i>&nbsp;Lihat
                        </button>
                        <button type="button" id="print" class="btn btn-outline-primary btn-sm btn-rounded">
                            <i class="fas fa-print"></i>&nbsp;Cetak
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {# end:: form #}
    {# begin:: tabel #}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Tabel</h3>
                    <hr>
                    {# begin:: tabel #}
                    <div id="lihat-tabel"></div>
                    {# end:: tabel #}
                </div>
            </div>
        </div>
    </div>
    {# end:: tabel #}
</div>
{# end:: body #}
{% endblock %}

{% block javascripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/parsley.js/2.9.2/parsley.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.4.1/js/bootstrap-datepicker.min.js"></script>

<script>
    // untuk datepicker
    var untukTanggal = function () {
        $('.datepicker').datepicker({
            format: 'yyyy-mm-dd',
            todayHighlight: true,
            autoclose: true,
        });
    }();

    // untuk lihat data
    var untukLihatData = function() {
        $('#form-add').submit(function(e) {
            e.preventDefault();

            $('#tanggal_awal').attr('required', 'required');
            $('#tanggal_akhir').attr('required', 'required');

            if ($('#form-add').parsley().isValid() == true) {
                $.ajax({
                    method: $(this).attr('method'),
                    url: $(this).attr('action'),
                    data: new FormData(this),
                    contentType: false,
                    processData: false,
                    dataType: 'html',
                    beforeSend: function() {
                        $('#add').attr('disabled', 'disabled');
                        $('#add').html('<i class="fas fa-spinner"></i>&nbsp;Waiting...');
                    },
                    success: function(response) {
                        $('#lihat-tabel').html(response);
                        $('#add').removeAttr('disabled');
                        $('#add').html('<i class="fas fa-eye"></i>&nbsp;Lihat');
                    }
                })
            }
        });
    }();

    // untuk export laporan
    var untukExport = function () {
        $(document).on('click', '#print', function () {
            var tanggal_awal = $('#tanggal_awal').val();
            var tanggal_akhir = $('#tanggal_akhir').val();

            if (tanggal_awal == '' || tanggal_akhir == '') {
                return false;
            } else {
                location.replace('laporan/export?tanggal_awal=' + btoa(tanggal_awal) + '&tanggal_akhir=' + btoa(tanggal_akhir), '_blank');
            }
        });
    }();

    // untuk format harga
	function autoSeparator(Num) {
		Num += '';
		Num = Num.replace('.', '');
		Num = Num.replace('.', '');
		Num = Num.replace('.', '');
		Num = Num.replace('.', '');
		Num = Num.replace('.', '');
		Num = Num.replace('.', '');
		x = Num.split('.');
		x1 = x[0];
		x2 = x.length > 1 ? '.' + x[1] : '';
		var rgx = /(\d+)(\d{3})/;
		while (rgx.test(x1))
			x1 = x1.replace(rgx, '$1' + '.' + '$2');
		return x1 + x2;
	};
</script>
{% endblock %}