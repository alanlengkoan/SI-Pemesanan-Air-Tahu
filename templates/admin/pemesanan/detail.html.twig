{% extends 'admin/layout_admin.html.twig' %}

{% block title %}Detail Pemesanan{% endblock %}

{% block body %}
{# begin:: head #}
<div class="page-breadcrumb">
    <div class="row">
        <div class="col-7 align-self-center">
            <h2 class="page-title text-truncate text-dark font-weight-medium mb-1">{{ halaman }}</h2>
        </div>
    </div>
</div>
{# end:: head #}

{# begin:: body #}
<div class="container-fluid">
    {# begin:: form #}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Biodata Pemesanan</h3>
                    <hr>
                    <form class="form" action="##" method="post" id="registrationForm">
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="nama" class="text-dark">
                                    <h4>Kode Order</h4>
                                </label>
                                <input type="text" id="inpkdpemesanan" class="form-control-plaintext" placeholder="{{ data_pemesanan.kd_pemesanan }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="email" class="text-dark">
                                    <h4>Nama</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ data_pemesanan.nama }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>Email</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ data_pemesanan.email }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>No. Telepon</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ data_pemesanan.telepon }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>Jenis Kelamin</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ (data_pemesanan.kelamin == 'L') ? 'Laki - laki' : 'Perempuan' }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>Alamat</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ data_pemesanan.alamat }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>Tanggal Pemesanan</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ data_pemesanan.tgl_pemesanan|date('d-m-Y') }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>Jam Pemesanan</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ data_pemesanan.tgl_pemesanan|date('H:i:s') }}" readonly>
                            </div>
                        </div>
                        <br>
                        <h3 class="card-title">Pembayaran</h3>
                        <hr>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>Metode Pembayaran</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ (data_pemesanan.metode_pembayaran == 'c') ? 'COD' : 'Transfer' }}" readonly>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-6">
                                <label for="username" class="text-dark">
                                    <h4>Status Pembayaran</h4>
                                </label>
                                <input type="text" class="form-control-plaintext" placeholder="{{ (data_pemesanan.status_pembayaran == 0) ? 'Menunggu Pembayaran' : 'Telah Melakukan Pembayaran' }}" readonly>
                            </div>
                        </div>
                        {% if data_pemesanan.metode_pembayaran == 't' %}
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Bank</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ data_pembayaran_detail.nama }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Nomor Rekening</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ data_pembayaran_detail.rekening }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Nomor Penyetor</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_detail.nama_penyetor == null) ? '-' : data_pembayaran_detail.nama_penyetor }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Atas Nama</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_detail.atas_nama == null) ? '-' : data_pembayaran_detail.atas_nama }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Jumlah Transfer</h4>
                                    </label>
                                    <div class="input-group mb-3">
                                        <input type="text" name="inpjumlahtransfer" id="inpjumlahtransfer" {{ (data_pembayaran_detail.jumlah_transfer == null ? 'class="form-control" placeholder="Jumlah transfer" onkeydown="return justAngka(event)" onkeyup="javascript:this.value=autoSeparator(this.value);"' : 'class=form-control-plaintext placeholder='~data_pembayaran_detail.jumlah_transfer|format_rp~' readonly') }} />
                                        {% if data_pembayaran_detail.jumlah_transfer == null %}
                                        <div class="input-group-prepend">
                                            <button class="btn btn-primary btn-outline" id="btn-simpan" type="button"><i class="fa fa-save"></i></button>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Tanggal Transfer</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_detail.tanggal_transfer == null) ? '-' : data_pembayaran_detail.tanggal_transfer|date('d-m-Y') }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Jam Transfer</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_detail.tanggal_transfer == null) ? '-' : data_pembayaran_detail.tanggal_transfer|date('H:i:s') }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Bukti</h4>
                                    </label>
                                    {% if (data_pembayaran_detail.bukti == null) %}
                                        - 
                                    {% else %}
                                        <a href="#" onclick="viewImage()">
                                            <img src="{{ asset('uploads/bukti/'~data_pembayaran_detail.bukti) }}" width="100" heigth="100" />
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                        {% elseif data_pemesanan.metode_pembayaran == 'c' %}
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Jam Transfer</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_cod.nama_bayar == null) ? '-' : data_pembayaran_cod.nama_bayar }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Jumlah Bayar</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_cod.jumlah_bayar == null) ? '-' : data_pembayaran_cod.jumlah_bayar|format_rp }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Tanggal Bayar</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_cod.tanggal_bayar == null) ? '-' : data_pembayaran_cod.tanggal_bayar|date('d-m-Y') }}" readonly>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-xs-6">
                                    <label for="username" class="text-dark">
                                        <h4>Jam Bayar</h4>
                                    </label>
                                    <input type="text" class="form-control-plaintext" placeholder="{{ (data_pembayaran_cod.tanggal_bayar == null) ? '-' : data_pembayaran_cod.tanggal_bayar|date('H:i:s') }}" readonly>
                                </div>
                            </div>
                            {% if data_pemesanan.status_pembayaran == '0' %}
                                 <div class="form-group">
                                     <div class="col-xs-12"><br>
                                        <a class="btn btn-lg btn-success btn-sm btn-rounded" href="/admin/pemesanan/bayar/{{ data_pemesanan.kd_pemesanan }}"><i class="fa fa-money"></i>&nbsp;Bayar</a>
                                     </div>
                                 </div>
                            {% endif %}
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
    </div>
    {# end:: form #}
    {# begin:: tabel #}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h3 class="card-title">Tabel</h3>
                    <hr>
                    <div class="table-responsive">
                        <table id="tabel_pemesanan" class="table table-striped table-bordered display no-wrap" style="width:100%">
                            <thead>
                                <tr>
                                    <th>No.</th>
                                    <th>Gambar</th>
                                    <th>Nama</th>
                                    <th>Jumlah</th>
                                    <th>Harga</th>
                                    <th>Sub Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% set sum = 0 %}
                                {% for rows in data_pemesanan_detail %}
                                {% set sum = sum + rows.sub_total  %}
                                <tr>
                                    <td>{{ loop.index }} </td>
                                    <td><img src="{{ asset('uploads/produk/'~rows.gambar) }}" width="100" heigth="100" /></td>
                                    <td>{{ rows.nama }}</td>
                                    <td>{{ rows.jumlah }}</td>
                                    <td align="center">{{ rows.harga|format_rp }}</td>
                                    <td align="center"><span id="sub-total">{{ rows.sub_total|format_rp }}</span></td>
                                </tr>
                                {% endfor %}
                                <tr>
                                    <td colspan="5" align="center">
                                        Total
                                    </td>
                                    <td align="center">
                                        <span id="total">{{ sum|format_rp }}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td colspan="5" align="center">
                                        Grand Total
                                    </td>
                                    <td align="center">
                                        <span id="total">{{ sum|format_rp }}</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br>
                    <a class="btn btn-lg btn-danger btn-sm btn-rounded" href="/admin/pemesanan"><i class="fa fa-arrow-left"></i>&nbsp;Kembali</a>
                    <a class="btn btn-lg btn-info btn-sm btn-rounded" href="#"><i class="fa fa-print"></i>&nbsp;Cetak</a>
                </div>
            </div>
        </div>
    </div>
    {# end:: tabel #}
</div>
{# end:: body #}
{% endblock %}

{% block javascripts %}
<script>
    var untukUbahAkun = function() {
        $(document).on('click', '#btn-simpan', function(e) {
            e.preventDefault();
            var ini = $(this);
            var kdPemesanan = $('#inpkdpemesanan').attr('placeholder');
            var jumlahTransfer = $('#inpjumlahtransfer').val();

            if (jumlahTransfer === '') {
                $('#inpjumlahtransfer').attr('required', 'required');
                alert('Jumlah Transfer tidak boleh kosong!');
            } else {
                $.ajax({
                    method: 'post',
                    url: '/admin/pembayaran_transfer',
                    dataType: 'json',
                    data: {
                        inpkdorder: kdPemesanan,
                        inpjumlahtransfer: jumlahTransfer,
                    },
                    beforeSend: function () {
                        ini.attr('disabled', 'disabled');
                    },
                    success: function (data) {
                        alert(data.msg);
                        location.reload()
                    }
                });
            }
        });
    }();

    // untuk angka
    function justAngka(e) {
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190, 77]) !== -1 ||
            (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
            (e.keyCode >= 35 && e.keyCode <= 40)) {
            return;
        }
        if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
    };

    // untuk format harga
    function autoSeparator(Num) {
        Num += '';
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        Num = Num.replace('.', '');
        x = Num.split('.');
        x1 = x[0];
        x2 = x.length > 1 ? '.' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1))
            x1 = x1.replace(rgx, '$1' + '.' + '$2');
        return x1 + x2;
    };

    // untuk lihat gambar pada tab baru
    function viewImage(url) {
        window.open("{{ asset('uploads/bukti/'~data_pembayaran_detail.bukti) }}");
    }
</script>
{% endblock %}