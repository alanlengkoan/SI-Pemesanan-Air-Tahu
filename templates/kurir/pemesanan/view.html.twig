{% extends 'kurir/layout_kurir.html.twig' %}

{% block title %}Pemesanan{% endblock %}

{% block stylesheets %}
<link href="{{ asset('assets/admin/extra-libs/datatables.net-bs4/css/dataTables.bootstrap4.css') }}" rel="stylesheet"/>
{% endblock %}

{% block body %}
{# begin:: head #}
<div class="page-breadcrumb">
    <div class="row">
        <div class="col-7 align-self-center">
            <h2 class="page-title text-truncate text-dark font-weight-medium mb-1">{{ halaman }}</h2>
        </div>
    </div>
</div>
{# end:: head #}

{# begin:: body #}
<div class="container-fluid">
    {# begin:: tabel #}
    <div class="row">
        {% set status_pengantaran = ['Dikemas', 'Dikirim', 'Diterima'] %}
        {% for rows in pemesanan %}
        <div class="col-12 mt-4">
            <div class="card">
                <div class="card-header">
                    <div class="row">
                        <div class="col-6">
                            {{ rows.kd_pemesanan }}
                        </div>
                        <div class="col-6 text-right">
                            <a class="btn btn-outline-info btn-sm btn-rounded" href="pemesanan/detail/{{ rows.kd_pemesanan }}" target="_blank"><i class="fas fa-info-circle"></i>&nbsp;Detail</a>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <h4 class="card-title">Order</h4>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="grid-container">
                                Nama
                            </div>
                        </div>
                        <div class="col-lg-6 ">
                            <div class="grid-container">
                                : {{ rows.nama }}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="grid-container">
                                Tanggal Pemesanan
                            </div>
                        </div>
                        <div class="col-lg-6 ">
                            <div class="grid-container">
                                : {{ rows.tgl_pemesanan|date('d-m-Y') }}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="grid-container">
                                Jam Pemesanan
                            </div>
                        </div>
                        <div class="col-lg-6 ">
                            <div class="grid-container">
                                : {{ rows.tgl_pemesanan|date('H:m:s') }}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="grid-container">
                                Status Pengantaran
                            </div>
                        </div>
                        <div class="col-lg-6 ">
                            <div class="grid-container">
                                : {{ status_pengantaran[rows.status_pengantaran] }}
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-6">
                            <div class="grid-container">
                                Total
                            </div>
                        </div>
                        <div class="col-lg-6 ">
                            <div class="grid-container">
                                : {{ rows.total|format_rp }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {# end:: tabel #}
</div>
{# end:: body #}
{% endblock %}

{% block javascripts %}
<script src="{{ asset('assets/admin/extra-libs/datatables.net/js/jquery.dataTables.min.js') }}"></script>
<script src="{{ asset('assets/admin/dist/js/pages/datatable/datatable-basic.init.js') }}"></script>

<script>
    // untuk datatable
    var untukDataTabel = function() {
        $('#tabel_pemesanan').DataTable();
        $('#tabel_kurir').DataTable();
    }();

    // untuk pilih kurir
    var untukPilihKurir = function() {
        $(document).on('click', '#pilih-kurir', function() {
            var ini = $(this);
            let id = ini.data('id');
            $('.pilih-kurir-ini').attr('data-kd_pemesanan', id);
        });
        
        $(document).on('click', '#pilih-kurir-ini', function() {
            var ini = $(this);
            let id_users = ini.data('id_users');
            let kd_pemesanan = ini.data('kd_pemesanan');
            
            swal({
                title: "Apakah Anda yakin ingin memilih kurir tersebut?",
                text: "Akun yang telah dipilih tidak dapat diubah!",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((del) => {
                if (del) {
                    $.ajax({
                        type: "post",
                        url: "pemesanan/pilih_kurir",
                        dataType: 'json',
                        data: {
                            id_users: id_users,
                            kd_pemesanan: kd_pemesanan
                        },
                        beforeSend: function () {
                            ini.attr('disabled', 'disabled');
                            ini.html('<i class="fas fa-spinner"></i>&nbsp;Menunggu');
                        },
                        success: function (response) {
                            swal({
                                title: response.title,
                                text: response.text,
                                icon: response.type,
                                button: response.button,
                            })
                            .then((value) => {
                                location.reload();
                            });
                        }
                    });
                } else {
                    return false;
                }
            });
        });
    }();
</script>
{% endblock %}